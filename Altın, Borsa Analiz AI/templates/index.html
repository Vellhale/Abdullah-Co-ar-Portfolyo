<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Finans Stratejisti</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eef2f3; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 900px; display: grid; gap: 20px; }
        .kart { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        h2 { margin-top: 0; color: #333; }
        
        /* Fiyat Kutusu */
        .fiyat-kutu { text-align: center; background: #fff8e1; border: 1px solid #ffe082; color: #d4af37; padding: 15px; border-radius: 10px; font-size: 24px; font-weight: bold; }

        /* YÃ¼kleme AlanÄ± */
        .yukleme-alani { border: 2px dashed #ccc; padding: 20px; text-align: center; border-radius: 10px; cursor: pointer; transition: 0.3s; margin-top: 10px;}
        .yukleme-alani:hover { border-color: #3949ab; background: #f0f4ff; }
        
        /* Chat AlanÄ± */
        .chat-kutu { height: 300px; overflow-y: auto; border: 1px solid #eee; padding: 15px; background: #fafafa; border-radius: 10px; margin-bottom: 15px; }
        .mesaj { margin-bottom: 10px; padding: 10px; border-radius: 10px; max-width: 80%; line-height: 1.4; }
        .mesaj.kullanici { background: #3949ab; color: white; margin-left: auto; text-align: right; }
        .mesaj.bot { background: #e0e0e0; color: #333; }
        
        /* Girdi AlanlarÄ± */
        .girdi-alani { display: flex; gap: 10px; }
        input[type="text"] { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
        button { padding: 10px 20px; border: none; border-radius: 20px; background: #3949ab; color: white; cursor: pointer; font-weight: bold; transition: 0.3s; }
        button:hover { background: #283593; transform: scale(1.05); }
        button:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        
        /* SeÃ§im Kutusu */
        select { padding: 10px; border-radius: 10px; border: 1px solid #ddd; margin-bottom: 10px; width: 100%; cursor: pointer; }

        /* YENÄ°: CanlÄ± Analiz KartÄ± Ã–zel Stili */
        .analiz-karti {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
        }
        .analiz-karti h2 { color: white; }
        .analiz-btn { background: #ff9800 !important; color: white; }
        .analiz-btn:hover { background: #e68900 !important; }
        .analiz-sonuc {
            margin-top: 15px; 
            background: rgba(255,255,255,0.1); 
            padding: 20px; 
            border-radius: 10px; 
            display: none; 
            font-size: 15px; 
            line-height: 1.6;
            border-left: 4px solid #ff9800;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="kart">
        <div class="fiyat-kutu" id="fiyatKutusu">Gram AltÄ±n: YÃ¼kleniyor...</div>
    </div>

    <div class="kart analiz-karti">
        <h2>ğŸŒ CanlÄ± Piyasa Analizi</h2>
        <p style="font-size: 14px; opacity: 0.9;">Yapay Zeka, Reuters/Bloomberg haberlerini tarar ve PDF raporlarÄ±nÄ±zla birleÅŸtirip yorumlar.</p>
        
        <div style="display: flex; gap: 10px;">
            <select id="kategoriAnaliz" style="color: black; flex: 1;">
                <option value="altin">ğŸ¥‡ AltÄ±n Haberlerini Yorumla</option>
                <option value="borsa">ğŸ“ˆ Borsa Haberlerini Yorumla</option>
            </select>
            <button onclick="canliAnalizYap()" class="analiz-btn" id="analizBtn">ANALÄ°Z BAÅLAT ğŸš€</button>
        </div>
        
        <div id="analizSonucu" class="analiz-sonuc">
            </div>
    </div>

    <div class="kart">
        <h2>ğŸ“š Bilgi KÃ¼tÃ¼phanesi</h2>
        <p style="font-size: 14px; color: #666;">Yapay zekanÄ±n hafÄ±zasÄ±nÄ± gÃ¼Ã§lendirmek iÃ§in rapor yÃ¼kleyin.</p>
        <select id="kategoriSecimYukle">
            <option value="altin">ğŸ¥‡ AltÄ±n PiyasasÄ± (Raporlar)</option>
            <option value="borsa">ğŸ“ˆ Borsa / Hisse (BilanÃ§olar)</option>
        </select>
        <div class="yukleme-alani" onclick="document.getElementById('fileInput').click()">
            <span id="yuklemeMetni">ğŸ“‚ PDF YÃ¼klemek Ä°Ã§in TÄ±kla</span>
            <input type="file" id="fileInput" accept=".pdf" style="display:none" onchange="dosyaYukle()">
        </div>
    </div>

    <div class="kart">
        <h2>ğŸ¤– AI UzmanÄ±na Sor</h2>
        <select id="kategoriSecimSoru">
            <option value="altin">ğŸ¥‡ AltÄ±n UzmanÄ±na Sor</option>
            <option value="borsa">ğŸ“ˆ Borsa UzmanÄ±na Sor</option>
        </select>
        <div class="chat-kutu" id="chatKutusu">
            <div class="mesaj bot">Merhaba! Haberleri takip ediyorum ve raporlarÄ± okudum. Bana sorabilirsin.</div>
        </div>
        <div class="girdi-alani">
            <input type="text" id="soruGirdisi" placeholder="Ã–rn: Fed kararÄ± altÄ±nÄ± nasÄ±l etkiler?">
            <button onclick="soruSor()" id="gonderBtn">GÃ¶nder</button>
        </div>
    </div>

</div>

<script>
    // FiyatÄ± Ã‡ek
    fetch('/api/fiyat').then(r => r.json()).then(d => { document.getElementById('fiyatKutusu').innerText = "Gram AltÄ±n: " + d.fiyat + " â‚º"; });

    // Dosya YÃ¼kleme Fonksiyonu
    function dosyaYukle() {
        const input = document.getElementById('fileInput');
        const file = input.files[0];
        const kategori = document.getElementById('kategoriSecimYukle').value;
        if (!file) return;

        const formData = new FormData();
        formData.append('file', file);
        formData.append('kategori', kategori);
        
        document.getElementById('yuklemeMetni').innerText = "â³ Ä°ÅŸleniyor... (Biraz sÃ¼rebilir)";

        fetch('/api/yukle', { method: 'POST', body: formData })
            .then(r => r.json())
            .then(data => {
                alert(data.mesaj);
                document.getElementById('yuklemeMetni').innerText = "ğŸ“‚ BaÅŸka PDF YÃ¼klemek Ä°Ã§in TÄ±kla";
                input.value = ""; // Inputu temizle
            })
            .catch(e => {
                alert("Hata oluÅŸtu!");
                document.getElementById('yuklemeMetni').innerText = "âŒ Hata";
            });
    }

    // Chat Fonksiyonu
    function soruSor() {
        const girdi = document.getElementById('soruGirdisi');
        const btn = document.getElementById('gonderBtn');
        const chat = document.getElementById('chatKutusu');
        const kategori = document.getElementById('kategoriSecimSoru').value;
        const soru = girdi.value.trim();
        
        if (!soru) return;

        chat.innerHTML += `<div class="mesaj kullanici">${soru}</div>`;
        chat.scrollTop = chat.scrollHeight;
        
        girdi.value = "";
        btn.innerText = "...";
        btn.disabled = true;

        fetch('/api/uzmana_sor', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ soru: soru, kategori: kategori })
        })
        .then(r => r.json())
        .then(data => {
            // CevabÄ± formatla (SatÄ±r baÅŸlarÄ±nÄ± dÃ¼zelt)
            let formatliCevap = data.cevap.replace(/\n/g, "<br>");
            chat.innerHTML += `<div class="mesaj bot"><b>[${kategori.toUpperCase()}]</b>:<br>${formatliCevap}</div>`;
            chat.scrollTop = chat.scrollHeight;
            btn.innerText = "GÃ¶nder";
            btn.disabled = false;
        })
        .catch(e => {
            chat.innerHTML += `<div class="mesaj bot" style="color:red">BaÄŸlantÄ± HatasÄ±!</div>`;
            btn.innerText = "GÃ¶nder";
            btn.disabled = false;
        });
    }

    // YENÄ°: CanlÄ± Analiz Fonksiyonu
    function canliAnalizYap() {
        const kategori = document.getElementById('kategoriAnaliz').value;
        const sonucKutusu = document.getElementById('analizSonucu');
        const btn = document.getElementById('analizBtn');
        
        sonucKutusu.style.display = 'block';
        sonucKutusu.innerHTML = "â³ <b>DÃ¼nya haberleri taranÄ±yor...</b><br>Global kaynaklar (Yahoo Finance, CNBC) okunuyor...<br>PDF raporlarÄ±yla karÅŸÄ±laÅŸtÄ±rÄ±lÄ±yor... LÃ¼tfen bekleyin.";
        btn.disabled = true;
        btn.innerText = "Analiz YapÄ±lÄ±yor...";
        
        fetch('/api/piyasa_yorumu', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ kategori: kategori })
        })
        .then(r => r.json())
        .then(data => {
            // Markdown benzeri baÅŸlÄ±klarÄ± HTML'e Ã§evir
            let temizCevap = data.cevap
                .replace(/\n/g, "<br>")
                .replace(/\*\*(.*?)\*\*/g, "<b>$1</b>"); // **KalÄ±n** yazÄ± desteÄŸi
            
            sonucKutusu.innerHTML = `<h3>ğŸ“¢ STRATEJÄ°ST RAPORU (${kategori.toUpperCase()})</h3>${temizCevap}`;
            btn.disabled = false;
            btn.innerText = "ANALÄ°Z BAÅLAT ğŸš€";
        })
        .catch(e => {
            sonucKutusu.innerHTML = "âŒ Hata oluÅŸtu: BaÄŸlantÄ± sorunu veya zaman aÅŸÄ±mÄ±.";
            btn.disabled = false;
            btn.innerText = "ANALÄ°Z BAÅLAT ğŸš€";
        });
    }
</script>

</body>
</html>